<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="FastReader - A free, open-source RSVP speed reading app. Read faster with Rapid Serial Visual Presentation.">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FastReader">
    
    <title>FastReader - RSVP Speed Reading</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" href="icons/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <!-- Fonts -->
    <link rel="preload" href="fonts/OpenDyslexic-Regular.otf" as="font" type="font/otf" crossorigin>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="dark">
    <!-- Offline Banner -->
    <div id="offlineBanner" class="offline-banner hidden">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 1l22 22M16.72 11.06A10.94 10.94 0 0119 12.55M5 12.55a10.94 10.94 0 015.17-2.39M10.71 5.05A16 16 0 0122.58 9M1.42 9a15.91 15.91 0 014.7-2.88M8.53 16.11a6 6 0 016.95 0M12 20h.01"/>
        </svg>
        <span>You're offline ‚Äî reading from cache</span>
    </div>

    <!-- Main Canvas -->
    <canvas id="stage"></canvas>

    <!-- Progress Display -->
    <div id="progressDisplay" class="progress-display">
        <span id="progressText">Word 0 of 0</span>
        <div id="progressBar" class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
        </div>
    </div>

    <!-- Controls -->
    <div id="controls" class="controls">
        <!-- Primary Controls -->
        <div class="controls-row primary-controls">
            <button id="resetBtn" class="btn btn-icon" title="Reset (R)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                    <path d="M3 3v5h5"/>
                </svg>
            </button>
            
            <button id="backBtn" class="btn btn-icon" title="Back (‚Üê)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            
            <button id="playBtn" class="btn btn-primary" title="Play/Pause (Space)">
                <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z"/>
                </svg>
                <svg id="pauseIcon" class="hidden" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 4h4v16H6zM14 4h4v16h-4z"/>
                </svg>
            </button>
            
            <button id="fwdBtn" class="btn btn-icon" title="Forward (‚Üí)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </button>
            
            <button id="textBtn" class="btn btn-icon" title="Set Text">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                </svg>
            </button>
        </div>

        <!-- Settings Toggle (Mobile) -->
        <button id="settingsToggle" class="btn btn-icon settings-toggle" title="Settings">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
            </svg>
        </button>

        <!-- Secondary Controls (Collapsible on mobile) -->
        <div id="settingsPanel" class="controls-row secondary-controls">
            <!-- WPM Control -->
            <div class="control-group wpm-control">
                <label id="wpmLabel" class="wpm-label" title="Click to edit">
                    WPM: <span id="wpmValue">300</span>
                </label>
                <input type="number" id="wpmInput" class="wpm-input hidden" min="50" max="1500" value="300">
                <input type="range" id="wpmRange" class="wpm-range" min="50" max="1500" value="300">
            </div>

            <!-- Profile Selector -->
            <div class="control-group">
                <select id="profileSelect" class="select" title="Pause Profile">
                    <option value="relaxed">Relaxed</option>
                    <option value="normal" selected>Normal</option>
                    <option value="speed">Speed</option>
                </select>
            </div>

            <!-- Font Selector -->
            <div class="control-group">
                <select id="fontSelect" class="select" title="Font">
                    <option value="system">System Default</option>
                    <option value="Arial">Arial</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Trebuchet MS">Trebuchet MS</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Courier New">Courier New</option>
                    <option value="OpenDyslexic">OpenDyslexic</option>
                </select>
            </div>

            <!-- Highlight Mode Selector -->
            <div class="control-group">
                <select id="highlightSelect" class="select" title="Highlight Mode">
                    <option value="classic">‚óâ Classic</option>
                    <option value="startEnd">‚ü®‚ü© Start-End</option>
                    <option value="adaptive">‚Üî Adaptive</option>
                    <option value="syllable">‚àø Syllable</option>
                    <option value="morpheme">‚ßà Morpheme</option>
                    <option value="minimal">‚óã Minimal</option>
                </select>
            </div>

            <!-- Toggle Buttons -->
            <button id="loopToggleBtn" class="btn btn-toggle" title="Loop">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 1l4 4-4 4"/>
                    <path d="M3 11V9a4 4 0 0 1 4-4h14"/>
                    <path d="M7 23l-4-4 4-4"/>
                    <path d="M21 13v2a4 4 0 0 1-4 4H3"/>
                </svg>
                <span class="toggle-label">Loop</span>
            </button>

            <button id="themeBtn" class="btn btn-toggle" title="Toggle Theme (T)">
                <svg id="sunIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                </svg>
                <svg id="moonIcon" class="hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>

            <button id="researchBtn" class="btn btn-toggle" title="Research & Science">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                </svg>
                <span class="toggle-label">Research</span>
            </button>

            <button id="soundToggleBtn" class="btn btn-toggle" title="Toggle Prosodic Sound">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                </svg>
                <span class="toggle-label">Sound</span>
            </button>
        </div>

        <!-- Sound Settings Panel (shown when sound enabled) -->
        <div id="soundSettingsPanel" class="sound-settings-panel hidden">
            <div class="sound-settings-header">
                <span>üîä Prosodic Sound per Mode</span>
            </div>
            <div class="sound-mode-toggles">
                <label class="sound-mode-toggle">
                    <input type="checkbox" id="sound-classic" class="sound-mode-checkbox" data-mode="classic">
                    <span class="sound-mode-label">‚óâ Classic</span>
                    <span class="sound-mode-desc">Pauses only</span>
                </label>
                <label class="sound-mode-toggle">
                    <input type="checkbox" id="sound-startEnd" class="sound-mode-checkbox" data-mode="startEnd">
                    <span class="sound-mode-label">‚ü®‚ü© Start-End</span>
                    <span class="sound-mode-desc">Phrase ticks</span>
                </label>
                <label class="sound-mode-toggle">
                    <input type="checkbox" id="sound-adaptive" class="sound-mode-checkbox" data-mode="adaptive">
                    <span class="sound-mode-label">‚Üî Adaptive</span>
                    <span class="sound-mode-desc">Dynamic cues</span>
                </label>
                <label class="sound-mode-toggle">
                    <input type="checkbox" id="sound-syllable" class="sound-mode-checkbox" data-mode="syllable">
                    <span class="sound-mode-label">‚àø Syllable</span>
                    <span class="sound-mode-desc">Stress ticks</span>
                </label>
                <label class="sound-mode-toggle">
                    <input type="checkbox" id="sound-morpheme" class="sound-mode-checkbox" data-mode="morpheme">
                    <span class="sound-mode-label">‚ßà Morpheme</span>
                    <span class="sound-mode-desc">Boundary cues</span>
                </label>
                <label class="sound-mode-toggle">
                    <input type="checkbox" id="sound-minimal" class="sound-mode-checkbox" data-mode="minimal">
                    <span class="sound-mode-label">‚óã Minimal</span>
                    <span class="sound-mode-desc">Silence</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Text Input Modal -->
    <div id="modalBackdrop" class="modal-backdrop hidden">
        <div class="modal">
            <div class="modal-header">
                <h2>Set Reading Text</h2>
                <button id="closeModalBtn" class="btn btn-icon modal-close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="modal-body">
                <textarea id="textArea" class="text-area" placeholder="Paste your text here..."></textarea>
                
                <div class="file-upload">
                    <label for="fileInput" class="file-label">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <span>Upload file (.txt, .pdf)</span>
                    </label>
                    <input type="file" id="fileInput" accept=".txt,.pdf,text/plain,application/pdf" class="file-input">
                </div>

                <!-- Recent PDFs -->
                <div id="recentPdfs" class="recent-pdfs hidden">
                    <h3>Recent Documents</h3>
                    <ul id="recentList" class="recent-list"></ul>
                </div>

                <!-- PDF Loading Status -->
                <div id="pdfStatus" class="pdf-status hidden">
                    <div class="pdf-status-icon">
                        <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                        </svg>
                    </div>
                    <span id="pdfStatusText">Loading PDF...</span>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="cancelModalBtn" class="btn btn-secondary">Cancel</button>
                <button id="applyModalBtn" class="btn btn-primary">Apply</button>
            </div>
        </div>
    </div>

    <!-- PDF Loading Options Modal -->
    <div id="pdfOptionsBackdrop" class="modal-backdrop hidden">
        <div class="modal modal-small">
            <div class="modal-header">
                <h2>PDF Loading Options</h2>
                <button id="closePdfOptionsBtn" class="btn btn-icon modal-close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="modal-body">
                <p id="pdfInfoText" class="pdf-info-text">This PDF has X pages (~Y words)</p>
                
                <div class="pdf-options">
                    <button id="loadAllPagesBtn" class="btn btn-option">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <path d="M14 2v6h6"/>
                            <path d="M12 18v-6M9 15l3 3 3-3"/>
                        </svg>
                        <div class="option-text">
                            <strong>Load All Pages</strong>
                            <span>Wait for complete document before reading</span>
                        </div>
                    </button>
                    
                    <button id="loadQuickStartBtn" class="btn btn-option">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                        <div class="option-text">
                            <strong>Quick Start</strong>
                            <span>Load first 3 pages, continue loading in background</span>
                        </div>
                    </button>
                </div>

                <!-- Loading Progress -->
                <div id="pdfLoadingProgress" class="pdf-loading-progress hidden">
                    <div class="pdf-status-icon">
                        <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                        </svg>
                    </div>
                    <span id="pdfLoadingText">Loading pages...</span>
                    <div class="progress-bar">
                        <div id="pdfProgressFill" class="progress-fill"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay (for PDF page loading during reading) -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-content">
            <svg class="spinner large" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
            </svg>
            <span>Loading next page...</span>
        </div>
    </div>

    <!-- Research Modal -->
    <div id="researchBackdrop" class="modal-backdrop hidden">
        <div class="modal modal-research">
            <div class="modal-header">
                <h2>üìö The Science Behind FastReader</h2>
                <button id="closeResearchBtn" class="btn btn-icon modal-close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="modal-body research-body">
                <!-- Tab Navigation -->
                <div class="research-tabs">
                    <button class="research-tab active" data-tab="classic">
                        <span class="tab-icon">‚óâ</span>
                        <span class="tab-label">Classic</span>
                    </button>
                    <button class="research-tab" data-tab="startend">
                        <span class="tab-icon">‚ü®‚ü©</span>
                        <span class="tab-label">Start-End</span>
                    </button>
                    <button class="research-tab" data-tab="adaptive">
                        <span class="tab-icon">‚Üî</span>
                        <span class="tab-label">Adaptive</span>
                    </button>
                    <button class="research-tab" data-tab="syllable">
                        <span class="tab-icon">‚àø</span>
                        <span class="tab-label">Syllable</span>
                    </button>
                    <button class="research-tab" data-tab="morpheme">
                        <span class="tab-icon">‚ßà</span>
                        <span class="tab-label">Morpheme</span>
                    </button>
                    <button class="research-tab" data-tab="minimal">
                        <span class="tab-icon">‚óã</span>
                        <span class="tab-label">Minimal</span>
                    </button>
                    <button class="research-tab" data-tab="sound">
                        <span class="tab-icon">üîä</span>
                        <span class="tab-label">Sound</span>
                    </button>
                </div>

                <!-- Tab Content Panels -->
                <div class="research-panels">
                    <!-- Classic Panel -->
                    <div id="panel-classic" class="research-panel active">
                        <div class="panel-header">
                            <h3>‚óâ Classic (Optimal Recognition Point)</h3>
                            <div class="panel-meta">
                                <span class="meta-tag best-for">üìñ Best for: General reading, fiction, news</span>
                                <span class="meta-tag speed">‚ö°‚ö°‚ö° Fast</span>
                            </div>
                        </div>
                        <div class="panel-description">
                            <p>The ORP (Optimal Recognition Point) is located slightly left of center‚Äîapproximately 35-40% from the start. This position minimizes eye travel distance for fastest word recognition.</p>
                        </div>
                        <div class="panel-papers">
                            <h4>üìÑ Research Papers</h4>
                            <div class="paper-card">
                                <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4617552/" target="_blank" rel="noopener">
                                    <strong>Potter, M.C., et al. (2014)</strong>
                                    <span>Detecting meaning in RSVP at 13 ms per picture</span>
                                </a>
                                <p class="paper-finding">üìå Finding: RSVP enables comprehension at 700+ WPM</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://www.sciencedirect.com/science/article/pii/S0042698909005252" target="_blank" rel="noopener">
                                    <strong>Rayner, K. (2009)</strong>
                                    <span>Eye movements and attention in reading</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Eyes naturally fixate at optimal positions</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://link.springer.com/article/10.3758/BF03200810" target="_blank" rel="noopener">
                                    <strong>O'Regan & Jacobs (1992)</strong>
                                    <span>Optimal viewing position effect in word recognition</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Seminal paper establishing OVP concept</p>
                            </div>
                        </div>
                    </div>

                    <!-- Start-End Panel -->
                    <div id="panel-startend" class="research-panel">
                        <div class="panel-header">
                            <h3>‚ü®‚ü© Start-End Anchoring</h3>
                            <div class="panel-meta">
                                <span class="meta-tag best-for">üìñ Best for: Technical docs, accessibility</span>
                                <span class="meta-tag speed">‚ö°‚ö°‚ö° Fast</span>
                            </div>
                        </div>
                        <div class="panel-description">
                            <p>Readers rely heavily on first and last letters for word recognition. The brain processes these "anchor" positions preferentially‚Äîeven scrambled middle letters don't prevent reading!</p>
                        </div>
                        <div class="panel-insight">
                            <span class="insight-icon">üí°</span>
                            <span><strong>Dyslexia-Friendly:</strong> Reinforces word boundaries, helpful for visual crowding effects</span>
                        </div>
                        <div class="panel-papers">
                            <h4>üìÑ Research Papers</h4>
                            <div class="paper-card">
                                <a href="https://link.springer.com/article/10.3758/s13423-012-0247-y" target="_blank" rel="noopener">
                                    <strong>Johnson & Eisler (2012)</strong>
                                    <span>The importance of first and last letters in sentence reading</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Transposing edge letters severely disrupts reading</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://www.sciencedirect.com/science/article/pii/S0010027704001775" target="_blank" rel="noopener">
                                    <strong>Grainger & Whitney (2004)</strong>
                                    <span>"Does the huamn mnid raed wrods as a wlohe?"</span>
                                </a>
                                <p class="paper-finding">üìå Finding: First/last letters are critical anchors</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3166198/" target="_blank" rel="noopener">
                                    <strong>White, Johnson, et al. (2008)</strong>
                                    <span>Eye movements when reading transposed text</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Edge letters have unique cognitive weight</p>
                            </div>
                        </div>
                    </div>

                    <!-- Adaptive Panel -->
                    <div id="panel-adaptive" class="research-panel">
                        <div class="panel-header">
                            <h3>‚Üî Adaptive Focus</h3>
                            <div class="panel-meta">
                                <span class="meta-tag best-for">üìñ Best for: Mixed content, varied vocabulary</span>
                                <span class="meta-tag speed">‚ö°‚ö°‚ö° Fast</span>
                            </div>
                        </div>
                        <div class="panel-description">
                            <p>Combines ORP with word length effects. Short words are processed holistically; longer words get strategic highlight placement that shifts based on structure.</p>
                        </div>
                        <div class="panel-papers">
                            <h4>üìÑ Research Papers</h4>
                            <div class="paper-card">
                                <a href="https://www.sciencedirect.com/science/article/pii/S0042698998002423" target="_blank" rel="noopener">
                                    <strong>Nazir, Jacobs & O'Regan (1998)</strong>
                                    <span>Letter legibility and visual word recognition</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Optimal position shifts based on word length</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://link.springer.com/article/10.3758/s13423-014-0634-1" target="_blank" rel="noopener">
                                    <strong>Schotter, Angele & Rayner (2012)</strong>
                                    <span>Parafoveal processing in reading</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Skilled readers dynamically allocate attention</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3117157/" target="_blank" rel="noopener">
                                    <strong>Vitu, O'Regan & Mittau (1990)</strong>
                                    <span>Optimal landing position in reading</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Landing position varies with word characteristics</p>
                            </div>
                        </div>
                    </div>

                    <!-- Syllable Panel -->
                    <div id="panel-syllable" class="research-panel">
                        <div class="panel-header">
                            <h3>‚àø Syllable Rhythm</h3>
                            <div class="panel-meta">
                                <span class="meta-tag best-for">üìñ Best for: Language learning, new vocabulary</span>
                                <span class="meta-tag speed">‚ö°‚ö° Moderate</span>
                            </div>
                        </div>
                        <div class="panel-description">
                            <p>Alternates colors by syllable boundaries. Leverages phonological structure to enhance fluency with complex or unfamiliar words.</p>
                        </div>
                        <div class="panel-insight">
                            <span class="insight-icon">üí°</span>
                            <span><strong>Language Learning:</strong> Especially effective for L2 learners‚Äîmakes phonological structure explicit</span>
                        </div>
                        <div class="panel-papers">
                            <h4>üìÑ Research Papers</h4>
                            <div class="paper-card">
                                <a href="https://www.sciencedirect.com/science/article/pii/S0028393218300318" target="_blank" rel="noopener">
                                    <strong>Chetail, F. (2015)</strong>
                                    <span>Orthographic redundancy in visual word recognition</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Syllable-based chunking aids multilingual reading</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://www.tandfonline.com/doi/abs/10.1080/02643294.2019.1659936" target="_blank" rel="noopener">
                                    <strong>Doignon-Camus & Zagar (2014)</strong>
                                    <span>The syllable frequency effect in word recognition</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Syllables are natural processing units</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://link.springer.com/article/10.1007/s11145-014-9534-0" target="_blank" rel="noopener">
                                    <strong>Bhattacharya & Ehri (2004)</strong>
                                    <span>Graphosyllabic analysis helps struggling readers</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Color-coded syllables aid vocabulary acquisition</p>
                            </div>
                        </div>
                    </div>

                    <!-- Morpheme Panel -->
                    <div id="panel-morpheme" class="research-panel">
                        <div class="panel-header">
                            <h3>‚ßà Morpheme Structure</h3>
                            <div class="panel-meta">
                                <span class="meta-tag best-for">üìñ Best for: Academic, STEM, legal/medical</span>
                                <span class="meta-tag speed">‚ö°‚ö° Moderate</span>
                            </div>
                        </div>
                        <div class="panel-description">
                            <p>Colors <span style="color:#4dabf7">prefix (blue)</span>, root (white), and <span style="color:#51cf66">suffix (green)</span> differently. Morphological awareness is one of the strongest predictors of reading comprehension!</p>
                        </div>
                        <div class="panel-insight">
                            <span class="insight-icon">üí°</span>
                            <span><strong>Academic Reading:</strong> Essential for STEM/medical/legal texts with Latin/Greek morphemes (anti-, bio-, -ology)</span>
                        </div>
                        <div class="panel-papers">
                            <h4>üìÑ Research Papers</h4>
                            <div class="paper-card">
                                <a href="https://psycnet.apa.org/record/2018-62611-001" target="_blank" rel="noopener">
                                    <strong>Levesque, Kieffer & Deacon (2019)</strong>
                                    <span>Morphological skills and reading comprehension</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Morphological awareness predicts comprehension</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4516776/" target="_blank" rel="noopener">
                                    <strong>Tighe & Schatschneider (2016)</strong>
                                    <span>Component reading skills in struggling adult readers</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Morphological skills predictive into adulthood</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://www.frontiersin.org/articles/10.3389/fpsyg.2014.00452/full" target="_blank" rel="noopener">
                                    <strong>Rastle & Davis (2008)</strong>
                                    <span>Morphological decomposition based on orthography</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Morphemes processed as discrete visual units</p>
                            </div>
                        </div>
                    </div>

                    <!-- Minimal Panel -->
                    <div id="panel-minimal" class="research-panel">
                        <div class="panel-header">
                            <h3>‚óã Minimal</h3>
                            <div class="panel-meta">
                                <span class="meta-tag best-for">üìñ Best for: Expert speed readers</span>
                                <span class="meta-tag speed">‚ö°‚ö°‚ö°‚ö° Fastest</span>
                            </div>
                        </div>
                        <div class="panel-description">
                            <p>Clean single-color display without highlighting. For skilled readers, visual scaffolding can become a distraction‚Äîthis mode removes it entirely.</p>
                        </div>
                        <div class="panel-papers">
                            <h4>üìÑ Research Papers</h4>
                            <div class="paper-card">
                                <a href="https://www.sciencedirect.com/science/article/pii/S1364661315002521" target="_blank" rel="noopener">
                                    <strong>Rayner, Pollatsek, et al. (2012)</strong>
                                    <span>Psychology of Reading (2nd ed.)</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Skilled readers process words in 150-300ms</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3579148/" target="_blank" rel="noopener">
                                    <strong>Kalyuga, S. (2007)</strong>
                                    <span>Expertise reversal effect in instruction</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Scaffolding helps novices but hinders experts</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://link.springer.com/article/10.3758/s13423-015-0879-y" target="_blank" rel="noopener">
                                    <strong>Schotter, Tran & Rayner (2014)</strong>
                                    <span>Comprehension supported by regressions during reading</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Skilled readers need less visual guidance</p>
                            </div>
                        </div>
                    </div>

                    <!-- Sound Science Panel -->
                    <div id="panel-sound" class="research-panel">
                        <div class="panel-header">
                            <h3>üîä Prosodic Sound Science</h3>
                            <div class="panel-meta">
                                <span class="meta-tag best-for">üéµ Optional audio cues for rhythm</span>
                                <span class="meta-tag speed">üß† Neurolinguistic</span>
                            </div>
                        </div>
                        <div class="panel-description">
                            <p>FastReader's prosodic sound system provides subtle audio cues aligned with linguistic boundaries. Based on neural oscillation theory and prosodic parsing research.</p>
                            
                            <h4>üéØ Global Sound Constraints</h4>
                            <ul class="sound-constraints">
                                <li><strong>Duration:</strong> 10‚Äì40 ms (never longer)</li>
                                <li><strong>Attack:</strong> &lt;5 ms (no slow fade-ins)</li>
                                <li><strong>Decay:</strong> &lt;30 ms</li>
                                <li><strong>Pitch:</strong> Fixed (no melody)</li>
                                <li><strong>Timbre:</strong> Soft click / muted tick</li>
                                <li><strong>Volume:</strong> ‚àí20 to ‚àí30 LUFS (subtle)</li>
                            </ul>
                            <p class="sound-why"><em>Short transients entrain timing without activating music/emotion circuits. Longer sounds trigger attentional competition.</em></p>

                            <h4>üìä Sound Strategy per Mode</h4>
                            <div class="sound-modes-table">
                                <div class="sound-mode-row">
                                    <span class="mode-name">‚óâ Classic (ORP)</span>
                                    <span class="mode-sound">Pauses only ‚Äî no ticks. Silence restores syntactic rhythm in RSVP.</span>
                                </div>
                                <div class="sound-mode-row">
                                    <span class="mode-name">‚ü®‚ü© Start‚ÄìEnd</span>
                                    <span class="mode-sound">Phrase-aligned soft ticks (20ms) reinforce chunk boundaries for working memory.</span>
                                </div>
                                <div class="sound-mode-row">
                                    <span class="mode-name">‚Üî Adaptive Focus</span>
                                    <span class="mode-sound">Dynamic pauses + sparse boundary ticks mimic natural reading prosody.</span>
                                </div>
                                <div class="sound-mode-row">
                                    <span class="mode-name">‚àø Syllable Rhythm</span>
                                    <span class="mode-sound">Stressed-syllable micro-ticks (10-15ms) align with theta-band (~4-8 Hz) for phonological parsing.</span>
                                </div>
                                <div class="sound-mode-row">
                                    <span class="mode-name">‚ßà Morpheme</span>
                                    <span class="mode-sound">Boundary confirmation ticks at prefix‚Üíroot and root‚Üísuffix transitions.</span>
                                </div>
                                <div class="sound-mode-row">
                                    <span class="mode-name">‚óã Minimal</span>
                                    <span class="mode-sound">Complete silence. Expert readers self-generate internal prosody.</span>
                                </div>
                            </div>

                            <h4>‚ö†Ô∏è Safety Rules</h4>
                            <ul class="sound-safety">
                                <li>‚ùå No melody or continuous background</li>
                                <li>‚ùå No enforced tempo or sync to every word</li>
                                <li>‚úÖ Encode structure, not speed</li>
                                <li>‚úÖ Prefer silence over sound</li>
                                <li>‚úÖ Fully optional per mode</li>
                            </ul>
                        </div>
                        <div class="panel-papers">
                            <h4>üìÑ Research Papers</h4>
                            <div class="paper-card">
                                <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3158676/" target="_blank" rel="noopener">
                                    <strong>Poeppel, D. (2003)</strong>
                                    <span>The analysis of speech in different temporal integration windows</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Theta oscillations (~4-8 Hz) parse syllabic structure</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://mitpress.mit.edu/9780262162487/music-language-and-the-brain/" target="_blank" rel="noopener">
                                    <strong>Patel, A.D. (2008)</strong>
                                    <span>Music, Language, and the Brain</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Prosodic cues improve parsing without activating music circuits</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://www.sciencedirect.com/science/article/pii/S0010027710001745" target="_blank" rel="noopener">
                                    <strong>Goswami, U. (2011)</strong>
                                    <span>A temporal sampling framework for developmental dyslexia</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Syllabic rhythm cues aid phonological processing</p>
                            </div>
                            <div class="paper-card">
                                <a href="https://psycnet.apa.org/record/2006-10322-001" target="_blank" rel="noopener">
                                    <strong>Baddeley, A. (2003)</strong>
                                    <span>Working memory and language</span>
                                </a>
                                <p class="paper-finding">üìå Finding: Chunking at phrase boundaries improves retention</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="welcomeBackdrop" class="modal-backdrop hidden">
        <div class="modal modal-welcome">
            <div class="modal-header">
                <h2>Welcome to FastReader</h2>
            </div>
            
            <div class="modal-body">
                <p class="welcome-intro">Choose a highlight mode based on what you'll be reading:</p>
                
                <div class="welcome-modes-grid">
                    <!-- Classic ORP -->
                    <div class="welcome-mode-card" data-mode="classic">
                        <div class="mode-icon">‚óâ</div>
                        <div class="mode-info">
                            <h3>Classic (ORP)</h3>
                            <p class="mode-desc">Center-focused highlighting at the Optimal Recognition Point</p>
                            <p class="mode-best"><strong>Best for:</strong> General reading, fiction, news articles</p>
                            <div class="mode-pros-cons">
                                <span class="pro">‚úì Minimizes eye movement</span>
                                <span class="pro">‚úì Industry standard</span>
                                <span class="con">‚úó Less effective for long words</span>
                            </div>
                        </div>
                    </div>

                    <!-- Start-End Anchoring -->
                    <div class="welcome-mode-card" data-mode="startEnd">
                        <div class="mode-icon">‚ü®‚ü©</div>
                        <div class="mode-info">
                            <h3>Start-End Anchoring</h3>
                            <p class="mode-desc">Highlights first <span style="color:#4dabf7">(blue)</span> and last <span style="color:#51cf66">(green)</span> letters</p>
                            <p class="mode-best"><strong>Best for:</strong> Technical docs, compound words, accessibility</p>
                            <div class="mode-pros-cons">
                                <span class="pro">‚úì Matches natural reading patterns</span>
                                <span class="pro">‚úì Dyslexia-friendly</span>
                                <span class="con">‚úó Less effective for short words</span>
                            </div>
                        </div>
                    </div>

                    <!-- Adaptive Focus -->
                    <div class="welcome-mode-card" data-mode="adaptive">
                        <div class="mode-icon">‚Üî</div>
                        <div class="mode-info">
                            <h3>Adaptive Focus</h3>
                            <p class="mode-desc">Dynamically shifts highlight based on word structure</p>
                            <p class="mode-best"><strong>Best for:</strong> Mixed content, varied vocabulary</p>
                            <div class="mode-pros-cons">
                                <span class="pro">‚úì Best of both worlds</span>
                                <span class="pro">‚úì Reduces monotony</span>
                                <span class="con">‚úó Requires adjustment period</span>
                            </div>
                        </div>
                    </div>

                    <!-- Syllable Rhythm -->
                    <div class="welcome-mode-card" data-mode="syllable">
                        <div class="mode-icon">‚àø</div>
                        <div class="mode-info">
                            <h3>Syllable Rhythm</h3>
                            <p class="mode-desc">Alternates colors by syllables for phonetic chunking</p>
                            <p class="mode-best"><strong>Best for:</strong> Language learning, scientific terms</p>
                            <div class="mode-pros-cons">
                                <span class="pro">‚úì Helps pronunciation</span>
                                <span class="pro">‚úì Great for new vocabulary</span>
                                <span class="con">‚úó Slower for expert readers</span>
                            </div>
                        </div>
                    </div>

                    <!-- Morpheme Structure -->
                    <div class="welcome-mode-card" data-mode="morpheme">
                        <div class="mode-icon">‚ßà</div>
                        <div class="mode-info">
                            <h3>Morpheme Structure</h3>
                            <p class="mode-desc">Colors <span style="color:#4dabf7">prefix</span>, root, and <span style="color:#51cf66">suffix</span> differently</p>
                            <p class="mode-best"><strong>Best for:</strong> Academic papers, medical/legal text, STEM</p>
                            <div class="mode-pros-cons">
                                <span class="pro">‚úì Reveals word meaning</span>
                                <span class="pro">‚úì Aids comprehension</span>
                                <span class="con">‚úó Overkill for simple text</span>
                            </div>
                        </div>
                    </div>

                    <!-- Minimal -->
                    <div class="welcome-mode-card" data-mode="minimal">
                        <div class="mode-icon">‚óã</div>
                        <div class="mode-info">
                            <h3>Minimal</h3>
                            <p class="mode-desc">Clean single-color display without highlighting</p>
                            <p class="mode-best"><strong>Best for:</strong> Experienced speed readers</p>
                            <div class="mode-pros-cons">
                                <span class="pro">‚úì No distractions</span>
                                <span class="pro">‚úì Maximum speed potential</span>
                                <span class="con">‚úó Not for beginners</span>
                            </div>
                        </div>
                    </div>
                </div>

                <p class="welcome-footer">
                    <em>You can change this anytime in the settings panel. Click a mode to begin!</em>
                </p>
            </div>
            
            <div class="modal-footer">
                <button id="skipWelcomeBtn" class="btn btn-secondary">Skip (use Classic)</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="lib/pdf.min.js"></script>
    <script src="db.js"></script>
    <script src="pdf-loader.js"></script>
    <script src="app.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW registered:', reg.scope))
                    .catch(err => console.warn('SW registration failed:', err));
            });
        }
    </script>
</body>
</html>
